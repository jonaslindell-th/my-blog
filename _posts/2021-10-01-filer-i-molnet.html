---
layout: post
title: "Filer i molnet"
date: 2021-10-01 14:01:10 +0200
categories: jekyll update
background: "/img/posts/cloudcomp.jpg"
---

<h3>Inledning</h3>

<p>
  I det här blogginlägget kommer jag skapa upp en Azure blob storage och en
  konsolapplikation som laddar upp bilder till mitt storage. Därefter skapa upp
  en webbapplikation som hämtar och visar upp bilderna.
</p>

<p>Jag börjar med att skapa upp ett nytt storage account i Azure portalen.</p>

<h3>Konsolapplikation</h3>

<p>
  För att komma igång med min konsolapp så skapar jag upp en ny klass och metod
  för att ladda upp mina bilder, som jag anropar från main metoden.
</p>

<p>Koden för min BlobManager ser ut så här.</p>

<img
  class="img-fluid"
  src="https://github.com/jonaslindell-th/my-blog/blob/main/img/posts/Filer-i-molnet/blobmanager.png?raw=true"
  alt="Bild på min kod för upload blob."
/>

<p>
  Här anger jag sökvägen till bilden jag vill ladda upp. Och tilldelar variabeln
  connectionString min connection string jag hämtat från mitt storage account
  som jag satt som environment variable för att dölja den under utveckling.
</p>

<img
  class="img-fluid"
  src="https://github.com/jonaslindell-th/my-blog/blob/main/img/posts/Filer-i-molnet/connectionstring.png?raw=true"
  alt="Bild på hur man får fram connection string i azure storage account"
/>

<p>
  Därefter skapar jag upp en ny instans av BlobClient och anger connectionstring
  till mitt storage, namnet på min container som bilder ska lagras i följt av
  namnet på min blob som parametrar. Jag har valt att använda mig av guid för
  namngivning för att undvika att få konflikter vid uppladdning.
</p>

<p>
  Laddar upp bilden med blobClient.Upload() med min filsökväg som parameter, mot
  min blobstorage. Hämtar in sökvägen till den uppladdade filen med absolut uri
  som jag sen skriver ut i consolen.
</p>

<img
  class="img-fluid"
  src="https://github.com/jonaslindell-th/my-blog/blob/main/img/posts/Filer-i-molnet/dotnet-run.png?raw=true"
  alt="Bild på dotnet run följt av imgurl"
/>

<p>Min container innehåller nu mina bilder.</p>

<img
  class="img-fluid"
  src="https://github.com/jonaslindell-th/my-blog/blob/main/img/posts/Filer-i-molnet/img-container.png?raw=true"
  alt="Bild på innehållet i min images container."
/>

<h3>Min Webbapp</h3>

<p>
  Nu när jag har mina bilder i Azure blob storage, vill jag visa upp dom i min
  webbapplikation. Använder mig av en Razor Page applikation, skapar en ny sida
  som jag döper till Images.
</p>

<p>
  I min ImagesModel så skapar jag en konstruktor för att få åtkomst till min
  connection string i appsettings.json med hjälp av IConfiguration injektionen.
  Skapar även upp en lista som jag ska kommer behöva lägga till min Uris jag
  hämtar ut från min container.
</p>

<p>
  Jag gör min OnGet metod till async som returnerar en task, för att se till att
  jag har tillgång till mina bilder innan jag returnerar sidan till användaren.
  Resten av min kod beskriver jag med kommentarer.
</p>

<img
  class="img-fluid"
  src="https://github.com/jonaslindell-th/my-blog/blob/main/img/posts/Filer-i-molnet/pagemodel.png?raw=true"
  alt="Min kod för min page model."
/>
<span style="margin-left: -25%" class="caption text-muted"
  >Är koden svår att tyda? Klicka på
  <a
    href="https://jonaslindell-th.github.io/my-blog/jekyll/update/2021/09/17/serverless-applications.html"
    >Länken</a
  ></span
>
